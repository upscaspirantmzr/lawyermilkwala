<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Customer Registration â€“ Milqly</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* tiny extra polish */
    .form-input:focus { box-shadow: 0 6px 18px rgba(59,130,246,0.12); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-r from-blue-50 to-blue-100 flex flex-col">

  <!-- NAV -->
  <header class="bg-white shadow sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-md bg-blue-100 flex items-center justify-center text-blue-600 font-bold">ðŸ¥›</div>
        <span class="text-xl font-semibold text-blue-700">Milk Delivery</span>
      </div>
      <nav class="space-x-4 text-sm">
        <a href="index.html" class="text-gray-700 hover:text-blue-600">Home</a>
        <a href="login.html" class="text-blue-600 font-medium bg-white px-3 py-1 rounded-lg hover:bg-blue-50">Login</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1 flex items-start justify-center py-12 px-4">
    <div class="max-w-xl w-full">
      <div class="bg-white rounded-2xl shadow-xl p-8 md:p-10">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center text-blue-600">Customer Registration</h1>
        <p class="mt-2 text-center text-gray-600">Create your account to start fresh milk subscription</p>

        <!-- Form -->
        <form id="registerForm" class="mt-8 space-y-4">
          <div>
            <label class="text-sm font-medium text-gray-700">Full Name</label>
            <input id="name" class="form-input mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none" placeholder="Enter your full name" required>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700">Email</label>
            <input id="email" type="email" class="form-input mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none" placeholder="Enter your email" required>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700">Phone Number</label>
            <input id="phone" type="tel" inputmode="tel"
              class="form-input mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none"
              placeholder="Enter your phone number (10 digits)" required>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700">Address</label>
            <textarea id="address" rows="3" class="form-input mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none" placeholder="Enter your delivery address" required></textarea>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700">Password</label>
            <input id="password" type="password" class="form-input mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none" placeholder="Create a password (min 6 chars)" required>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700">Subscription Plan</label>
            <select id="plan" class="mt-1 block w-full rounded-xl border border-gray-200 px-4 py-3 focus:outline-none">
              <option value="">Select Plan (optional)</option>
              <option value="weekly">Weekly Subscription</option>
              <option value="monthly">Monthly Subscription</option>
            </select>
          </div>

          <div class="mt-4">
            <button id="btnRegister" type="submit"
              class="w-full rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-3 shadow">
              Register
            </button>
          </div>

          <p id="formMsg" class="text-sm mt-2 text-center"></p>

          <p class="text-center text-gray-600 mt-1">
            Already have an account?
            <a href="login.html" class="text-blue-600 font-medium hover:underline">Login here</a>
          </p>
        </form>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="bg-white border-t">
    <div class="max-w-6xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
      Â© 2025 Milk Delivery. All rights reserved.
    </div>
  </footer>

  <!-- Firebase (modular) -->
  <script type="module">
    // ----- Firebase imports -----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // ----- Your Firebase Config (provided) -----
    const firebaseConfig = {
      apiKey: "AIzaSyCayl1Hkzf7krOjqlxqWEbBpNZC8m41BBk",
      authDomain: "milqly.firebaseapp.com",
      projectId: "milqly",
      storageBucket: "milqly.firebasestorage.app",
      messagingSenderId: "509357207390",
      appId: "1:509357207390:web:47a4c7bc0af3373cd0a9cf",
      measurementId: "G-Z576VSVC5J"
    };

    // ----- Initialize -----
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ----- UI helpers -----
    const $ = id => document.getElementById(id);
    const formMsg = $("formMsg");
    function setMsg(text, ok=false){
      formMsg.textContent = text || "";
      formMsg.className = ok ? "text-sm mt-2 text-green-600" : "text-sm mt-2 text-red-600";
    }

    // ----- Registration logic -----
    $("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      setMsg("");

      const name = $("name").value.trim();
      const email = $("email").value.trim().toLowerCase();
      const phone = $("phone").value.trim();
      const address = $("address").value.trim();
      const password = $("password").value;
      const plan = $("plan").value || null;

      // Basic validation
      if (!name || !email || !phone || !address || !password) {
        return setMsg("Please fill all required fields.");
      }
      if (!/^\d{10}$/.test(phone)) {
        return setMsg("Phone must be 10 digits.");
      }
      if (password.length < 6) {
        return setMsg("Password must be at least 6 characters.");
      }

      // Disable button while processing
      const btn = $("btnRegister");
      btn.disabled = true;
      btn.classList.add("opacity-70", "cursor-not-allowed");

      try {
        // Create user in Firebase Auth (this also signs them in)
        const cred = await createUserWithEmailAndPassword(auth, email, password);

        // Set display name in Auth profile
        await updateProfile(cred.user, { displayName: name });

        // Create Firestore user doc
        const userRef = doc(db, "users", cred.user.uid);
        await setDoc(userRef, {
          name,
          email,
          phone,
          address,
          role: "user",
          preferredPlan: plan,
          createdAt: serverTimestamp()
        });

        // Success â€” redirect to dashboard
        setMsg("Registration successful â€” redirecting to dashboard...", true);
        setTimeout(() => {
          window.location.href = "user-dashboard.html";
        }, 1100);

      } catch (err) {
        setMsg(err && err.message ? err.message : "Registration failed.");
        btn.disabled = false;
        btn.classList.remove("opacity-70", "cursor-not-allowed");
      }
    });
  </script>
</body>
</html>
