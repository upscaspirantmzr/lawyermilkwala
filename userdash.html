<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; }
    header { background:#4CAF50; color:white; padding:15px; text-align:center; }
    section { margin:20px; padding:20px; background:white; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-top:0; }
    button { padding:10px 20px; border:none; border-radius:6px; background:#f44336; color:white; cursor:pointer; }
    button:hover { background:#d32f2f; }
    .label { font-weight:bold; }
  </style>
</head>
<body>
  <header>
    <h2 id="welcome">Loading...</h2>
  </header>

  <section>
    <h3>Profile</h3>
    <p><span class="label">Name:</span> <span id="name">Loading...</span></p>
    <p><span class="label">Email:</span> <span id="email">Loading...</span></p>
    <p><span class="label">Address:</span> <span id="address">Loading...</span></p>
  </section>

  <section>
    <h3>Subscription</h3>
    <p><span class="label">Plan:</span> <span id="plan">Loading...</span></p>
    <p><span class="label">Start:</span> <span id="start">Loading...</span></p>
    <p><span class="label">End:</span> <span id="end">Loading...</span></p>
    <p><span class="label">Status:</span> <span id="status">Loading...</span></p>
  </section>

  <section>
    <h3>Delivery Status</h3>
    <p><span class="label">Today:</span> <span id="delivery-status">Loading...</span></p>
  </section>

  <section>
    <button onclick="logout()">Logout</button>
  </section>

  <!-- âœ… Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¥ Your Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      projectId: "YOUR-PROJECT",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "SENDER-ID",
      appId: "APP-ID"
    };

    // âœ… Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // âœ… Auth state listener
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "login.html"; // redirect if not logged in
        return;
      }

      document.getElementById("welcome").textContent = `Welcome, ${user.displayName || "User"} ðŸ‘‹`;

      try {
        // ðŸ”¹ Profile
        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists) {
          const data = userDoc.data();
          document.getElementById("name").textContent = data.name || "N/A";
          document.getElementById("email").textContent = user.email;
          document.getElementById("address").textContent = data.address || "N/A";
        }

        // ðŸ”¹ Subscription
        const subDoc = await db.collection("subscriptions").doc(user.uid).get();
        if (subDoc.exists) {
          const sub = subDoc.data();
          document.getElementById("plan").textContent = sub.plan || "N/A";
          document.getElementById("start").textContent = sub.startDate || "N/A";
          document.getElementById("end").textContent = sub.endDate || "N/A";
          document.getElementById("status").textContent = sub.status || "N/A";
        }

        // ðŸ”¹ Deliveries
        const delDoc = await db.collection("deliveries").doc(user.uid).get();
        if (delDoc.exists) {
          const del = delDoc.data();
          document.getElementById("delivery-status").textContent = del.today || "Pending";
        }

      } catch (err) {
        console.error("Error loading dashboard:", err);
      }
    });

    // âœ… Logout
    function logout() {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      });
    }
  </script>
</body>
</html>
